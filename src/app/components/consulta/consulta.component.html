<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-notes-medical me-2"></i>Crear Nueva Consulta
                </h5>
                <a routerLink="/consultas" class="btn btn-light btn-sm">
                    <i class="fas fa-arrow-left me-1"></i> Volver
                </a>
            </div>
        </div>

        <div class="card-body">
            <form #f="ngForm" (ngSubmit)="guardar(f)" novalidate>
                <!-- Paciente -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <label for="paciente" class="form-label">
                            Paciente <span class="text-danger">*</span>
                        </label>
                        <select id="paciente" class="form-select" [(ngModel)]="consulta.paciente" name="paciente"
                            required [class.is-invalid]="f.submitted && f.controls['paciente'].invalid">
                            <option [ngValue]="null">-- Selecciona un paciente --</option>
                            <option *ngFor="let p of pacientes" [ngValue]="p.usuario.id">
                                {{ p.usuario.nombre }} {{ p.usuario.apellido }}
                            </option>
                        </select>
                        <div class="invalid-feedback" *ngIf="f.submitted && f.controls['paciente'].invalid">
                            Debe seleccionar un paciente.
                        </div>
                    </div>
                </div>

                <!-- Detalles de la consulta -->
                <div class="row mb-4">
                    <div class="col-md-12 mb-3">
                        <label for="motivo_consulta" class="form-label">
                            Motivo de la consulta <span class="text-danger">*</span>
                        </label>
                        <textarea id="motivo_consulta" class="form-control" [(ngModel)]="consulta.motivo_consulta"
                            name="motivo_consulta" required rows="2" placeholder="Describa el motivo principal"
                            [class.is-invalid]="f.submitted && f.controls['motivo_consulta'].invalid"></textarea>
                        <div class="invalid-feedback" *ngIf="f.submitted && f.controls['motivo_consulta'].invalid">
                            El motivo de la consulta es obligatorio.
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="sintomas" class="form-label">Síntomas</label>
                        <textarea id="sintomas" class="form-control" [(ngModel)]="consulta.sintomas" name="sintomas"
                            rows="2" placeholder="Describa los síntomas"></textarea>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="diagnostico" class="form-label">Diagnóstico</label>
                        <textarea id="diagnostico" class="form-control" [(ngModel)]="consulta.diagnostico"
                            name="diagnostico" rows="2" placeholder="Ingrese el diagnóstico"></textarea>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="tratamiento" class="form-label">Tratamiento</label>
                        <textarea id="tratamiento" class="form-control" [(ngModel)]="consulta.tratamiento"
                            name="tratamiento" rows="2" placeholder="Indique el tratamiento"></textarea>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="observaciones" class="form-label">Observaciones</label>
                        <textarea id="observaciones" class="form-control" [(ngModel)]="consulta.observaciones"
                            name="observaciones" rows="2" placeholder="Notas adicionales"></textarea>
                    </div>
                </div>

                <!-- Mensajes -->
                <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Error:</strong> {{ error }}
                    <button type="button" class="btn-close" (click)="error = undefined"></button>
                </div>

                <div *ngIf="mensaje" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Éxito:</strong> {{ mensaje }}
                    <button type="button" class="btn-close" (click)="mensaje = undefined"></button>
                </div>

                <!-- Botones -->
                <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                    <div>



                        <!-- Botones -->
                        <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                            <div>
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Los campos marcados con <span class="text-danger">*</span> son obligatorios.
                                </small>
                            </div>

                            <div class="d-flex gap-2">
                                <a routerLink="/consultas" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-1"></i> Cancelar
                                </a>

                                <button type="submit" class="btn btn-primary" [disabled]="guardando || f.invalid">
                                    <ng-container *ngIf="!guardando; else loading">
                                        <i class="fas fa-save me-1"></i> Guardar Consulta
                                    </ng-container>
                                    <ng-template #loading>
                                        <i class="fas fa-spinner fa-spin me-1"></i> Guardando...
                                    </ng-template>
                                </button>
                            </div>
                        </div>
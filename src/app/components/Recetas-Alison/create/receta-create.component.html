<div class="container mt-4">

  <!-- TÍTULO -->
  <div class="card shadow-sm mb-4">
    <div class="card-body d-flex justify-content-between align-items-center">
      <h4 class="fw-bold text-primary mb-0">
        <i class="fas fa-prescription me-2"></i> Nueva Receta Médica
      </h4>
      <button class="btn btn-secondary btn-sm" (click)="volver()">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </button>
    </div>
  </div>

  <!-- FORMULARIO -->
  <div class="card shadow-sm">
    <div class="card-body">

      <form class="row g-3" novalidate>

        <!-- Consulta médica -->
        <div class="col-md-6">
          <label class="form-label small fw-semibold">Consulta Médica *</label>
          <select class="form-select form-select-sm"
                  [(ngModel)]="nuevaReceta.consulta"
                  name="consulta"
                  (change)="actualizarPaciente()">
            <option value="">Seleccione</option>
            <option *ngFor="let c of consultasDisponibles" [value]="c.id">
              Consulta #{{ c.id }} - 
              {{ c.fecha ? formatearFecha(c.fecha) : 'Fecha no disponible' }} - 
              {{ c.paciente }}
            </option>
          </select>
        </div>

        <!-- Paciente -->
        <div class="col-md-6">
          <label class="form-label small fw-semibold">Paciente</label>
          <input type="text" class="form-control form-control-sm bg-light"
                 [(ngModel)]="nuevaReceta.paciente" name="paciente" readonly>
        </div>

        <!-- Observaciones -->
        <div class="col-12">
          <label class="form-label small fw-semibold">Observaciones</label>
          <textarea class="form-control form-control-sm" rows="3"
                    [(ngModel)]="nuevaReceta.observaciones"
                    name="observaciones"
                    placeholder="Escriba observaciones adicionales..."></textarea>
        </div>

        <!-- Medicamentos -->
        <div class="col-12 mt-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <label class="form-label small fw-semibold mb-0">Medicamentos</label>
            <button type="button" class="btn btn-sm btn-outline-primary" (click)="agregarMedicamento()">
              <i class="fas fa-plus me-1"></i> Agregar
            </button>
          </div>

          <div *ngFor="let med of nuevaReceta.detalles; let i = index"
               class="card border-light mb-3">

            <div class="card-header bg-light fw-semibold py-2">
              Medicamento {{ i + 1 }}
              <button type="button" 
                      class="btn btn-sm btn-outline-danger float-end"
                      (click)="eliminarMedicamento(i)"
                      title="Eliminar">
                <i class="fas fa-trash"></i>
              </button>
            </div>

            <div class="card-body row g-2">

              <!-- Nombre -->
              <div class="col-md-4">
                <label class="form-label small text-muted">Nombre</label>
                <input class="form-control form-control-sm"
                       [(ngModel)]="med.medicamento"
                       name="medicamento{{ i }}"
                       placeholder="Ej: Paracetamol 500mg">
              </div>

              <!-- Dosis -->
              <div class="col-md-2">
                <label class="form-label small text-muted">Dosis</label>
                <input class="form-control form-control-sm"
                       [(ngModel)]="med.dosis"
                       name="dosis{{ i }}"
                       placeholder="1 tableta">
              </div>

              <!-- Frecuencia -->
              <div class="col-md-3">
                <label class="form-label small text-muted">Frecuencia</label>
                <input class="form-control form-control-sm"
                       [(ngModel)]="med.frecuencia"
                       name="frecuencia{{ i }}"
                       placeholder="Cada 8 horas">
              </div>

              <!-- Duración -->
              <div class="col-md-3">
                <label class="form-label small text-muted">Duración</label>
                <input class="form-control form-control-sm"
                       [(ngModel)]="med.duracion"
                       name="duracion{{ i }}"
                       placeholder="7 días">
              </div>

              <!-- Indicaciones -->
              <div class="col-12">
                <label class="form-label small text-muted">Indicaciones</label>
                <input class="form-control form-control-sm"
                       [(ngModel)]="med.indicaciones"
                       name="indicaciones{{ i }}"
                       placeholder="Tomar después de las comidas">
              </div>

            </div>
          </div>

        </div>

      </form>

    </div>
  </div>

  <!-- BOTONES -->
  <div class="d-flex justify-content-end mt-4 gap-2">
    <button class="btn btn-secondary btn-sm" (click)="volver()">
      <i class="fas fa-arrow-left me-1"></i> Cancelar
    </button>
    <button class="btn btn-success btn-sm" (click)="guardarReceta()">
      <i class="fas fa-save me-1"></i> Guardar Receta
    </button>
  </div>

</div>

<div class="container mt-4">

  <!-- ENCABEZADO -->
  <div class="card shadow-sm mb-4">
    <div class="card-body d-flex justify-content-between align-items-center">
      <h4 class="fw-bold text-success mb-0">
        <i class="fas fa-pen me-2"></i> Editar Receta Médica
      </h4>
      <button class="btn btn-secondary btn-sm" (click)="volver()">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </button>
    </div>
  </div>

  <!-- FORMULARIO PRINCIPAL -->
  <div class="card shadow-sm">
    <div class="card-body">
      <form class="row g-3">

        <!-- CONSULTA DE RECETA (NO EDITABLE) -->
        <div class="col-md-6">
          <label class="form-label fw-semibold small">Consulta Médica</label>
          <input
            type="text"
            class="form-control form-control-sm bg-light"
            [value]="'Consulta #' + receta?.consulta"
            disabled
          />
        </div>

        <!-- PACIENTE -->
        <div class="col-md-6">
          <label class="form-label fw-semibold small">Paciente</label>
          <input
            type="text"
            class="form-control form-control-sm bg-light"
            [value]="receta?.paciente"
            disabled
          />
        </div>

        <!-- OBSERVACIONES -->
        <div class="col-12">
          <label class="form-label fw-semibold small">Observaciones</label>
          <textarea
            class="form-control form-control-sm"
            [(ngModel)]="receta.observaciones"
            name="observaciones"
            rows="3"
          ></textarea>
        </div>

        <!-- MEDICAMENTOS -->
        <div class="col-12 mt-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <label class="form-label fw-semibold small mb-0">Medicamentos</label>
            <button type="button"
                    class="btn btn-sm btn-outline-primary"
                    (click)="agregarMedicamento()">
              <i class="fas fa-plus me-1"></i> Agregar
            </button>
          </div>

          <!-- LISTA DE DETALLES -->
          <div *ngFor="let med of receta?.detalles; let i = index" class="card border-light mb-3">

            <!-- HEADER DEL DETALLE -->
            <div class="card-header bg-light fw-semibold py-2">
              Medicamento {{ i + 1 }}
              <button
                type="button"
                class="btn btn-sm btn-outline-danger float-end"
                (click)="eliminarMedicamento(i)">
                <i class="fas fa-trash"></i>
              </button>
            </div>

            <!-- CAMPOS DE MEDICAMENTO -->
            <div class="card-body row g-2">

              <div class="col-md-4">
                <label class="form-label small text-muted">Nombre</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  [(ngModel)]="med.medicamento"
                  name="medicamento{{ i }}"
                  placeholder="Paracetamol 500mg"
                />
              </div>

              <div class="col-md-2">
                <label class="form-label small text-muted">Dosis</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  [(ngModel)]="med.dosis"
                  name="dosis{{ i }}"
                  placeholder="1 tableta"
                />
              </div>

              <div class="col-md-3">
                <label class="form-label small text-muted">Frecuencia</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  [(ngModel)]="med.frecuencia"
                  name="frecuencia{{ i }}"
                  placeholder="Cada 8 horas"
                />
              </div>

              <div class="col-md-3">
                <label class="form-label small text-muted">Duración</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  [(ngModel)]="med.duracion"
                  name="duracion{{ i }}"
                  placeholder="7 días"
                />
              </div>

              <div class="col-12">
                <label class="form-label small text-muted">Indicaciones</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  [(ngModel)]="med.indicaciones"
                  name="indicaciones{{ i }}"
                  placeholder="Tomar después de las comidas"
                />
              </div>

            </div>

          </div>
        </div>

      </form>
    </div>
  </div>

  <!-- BOTONES -->
  <div class="d-flex justify-content-end mt-4 gap-2">
    <button class="btn btn-secondary btn-sm" (click)="volver()">
      <i class="fas fa-times me-1"></i> Cancelar
    </button>

    <button class="btn btn-success btn-sm" (click)="guardarCambios()">
      <i class="fas fa-save me-1"></i> Guardar Cambios
    </button>
  </div>

</div>

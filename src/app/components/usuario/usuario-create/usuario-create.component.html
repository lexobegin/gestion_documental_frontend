<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
          <i class="fas fa-user-plus me-2"></i>Crear Nuevo Usuario
        </h5>
        <a routerLink="/usuarios" class="btn btn-light btn-sm">
          <i class="fas fa-arrow-left me-1"></i> Volver
        </a>
      </div>
    </div>

    <div class="card-body">
      <form #f="ngForm" (ngSubmit)="guardar(f)" novalidate>
        <!-- Información Personal -->
        <div class="row mb-4">
          <div class="col-12">
            <h6 class="text-primary mb-3">
              <i class="fas fa-user me-2"></i>Información Personal
            </h6>
          </div>

          <div class="col-md-6 mb-3">
            <label for="nombre" class="form-label"
              >Nombre <span class="text-danger">*</span></label
            >
            <input
              id="nombre"
              type="text"
              class="form-control"
              [(ngModel)]="usuario.nombre"
              name="nombre"
              required
              minlength="2"
              maxlength="50"
              placeholder="Ingrese el nombre"
              [class.is-invalid]="f.submitted && f.controls['nombre'].invalid"
            />
            <div
              class="invalid-feedback"
              *ngIf="f.submitted && f.controls['nombre'].invalid"
            >
              El nombre es requerido y debe tener al menos 2 caracteres.
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="apellido" class="form-label"
              >Apellido <span class="text-danger">*</span></label
            >
            <input
              id="apellido"
              type="text"
              class="form-control"
              [(ngModel)]="usuario.apellido"
              name="apellido"
              required
              minlength="2"
              maxlength="50"
              placeholder="Ingrese el apellido"
              [class.is-invalid]="f.submitted && f.controls['apellido'].invalid"
            />
            <div
              class="invalid-feedback"
              *ngIf="f.submitted && f.controls['apellido'].invalid"
            >
              El apellido es requerido y debe tener al menos 2 caracteres.
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="email" class="form-label"
              >Email <span class="text-danger">*</span></label
            >
            <input
              id="email"
              type="email"
              class="form-control"
              [(ngModel)]="usuario.email"
              name="email"
              required
              placeholder="ejemplo@correo.com"
              [class.is-invalid]="f.submitted && f.controls['email'].invalid"
            />
            <div
              class="invalid-feedback"
              *ngIf="f.submitted && f.controls['email'].invalid"
            >
              Por favor ingrese un email válido.
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="telefono" class="form-label">Teléfono</label>
            <input
              id="telefono"
              type="tel"
              class="form-control"
              [(ngModel)]="usuario.telefono"
              name="telefono"
              placeholder="+34 123 456 789"
              pattern="[0-9+\-\s()]+"
              maxlength="20"
            />
            <div class="form-text">Opcional</div>
          </div>
        </div>

        <!-- Información del Sistema -->
        <div class="row mb-4">
          <div class="col-12">
            <h6 class="text-primary mb-3">
              <i class="fas fa-cog me-2"></i>Información del Sistema
            </h6>
          </div>

          <div class="col-md-6 mb-3">
            <label for="id_rol" class="form-label"
              >Rol <span class="text-danger">*</span></label
            >
            <select
              id="id_rol"
              class="form-select"
              [(ngModel)]="usuario.id_rol"
              name="id_rol"
              required
              [class.is-invalid]="f.submitted && f.controls['id_rol'].invalid"
            >
              <option [ngValue]="null">-- Selecciona un rol --</option>
              <option *ngFor="let r of roles" [ngValue]="r.id">
                {{ r.nombre }}
              </option>
            </select>
            <div
              class="invalid-feedback"
              *ngIf="f.submitted && f.controls['id_rol'].invalid"
            >
              Debe seleccionar un rol para el usuario.
            </div>
            <div *ngIf="roles.length === 0" class="form-text text-warning">
              <i class="fas fa-exclamation-triangle me-1"></i>
              No hay roles disponibles. Contacte al administrador.
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <div class="form-check form-switch mt-4">
              <input
                id="activo"
                class="form-check-input"
                type="checkbox"
                [(ngModel)]="usuario.activo"
                name="activo"
                role="switch"
              />
              <label for="activo" class="form-check-label fw-bold">
                Usuario Activo
              </label>
            </div>
            <div class="form-text">
              Los usuarios inactivos no pueden acceder al sistema.
            </div>
          </div>
        </div>

        <!-- Seguridad -->
        <div class="row mb-4">
          <div class="col-12">
            <h6 class="text-primary mb-3">
              <i class="fas fa-shield-alt me-2"></i>Seguridad
            </h6>
          </div>

          <div class="col-md-6 mb-3">
            <label for="password" class="form-label"
              >Contraseña <span class="text-danger">*</span></label
            >
            <input
              id="password"
              type="password"
              class="form-control"
              [(ngModel)]="usuario.password"
              name="password"
              required
              minlength="6"
              placeholder="Mínimo 6 caracteres"
              autocomplete="new-password"
              [class.is-invalid]="f.submitted && f.controls['password'].invalid"
            />
            <div
              class="invalid-feedback"
              *ngIf="f.submitted && f.controls['password'].invalid"
            >
              La contraseña debe tener al menos 6 caracteres.
            </div>
            <div class="form-text">
              <i class="fas fa-info-circle me-1"></i>
              La contraseña debe tener al menos 6 caracteres.
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="confirmPassword" class="form-label"
              >Confirmar Contraseña <span class="text-danger">*</span></label
            >
            <input
              id="confirmPassword"
              type="password"
              class="form-control"
              [(ngModel)]="usuario.confirmPassword"
              name="confirmPassword"
              required
              minlength="6"
              placeholder="Repita la contraseña"
              autocomplete="new-password"
              [class.is-invalid]="
                f.submitted &&
                (f.controls['confirmPassword'].invalid ||
                  usuario.password !== usuario.confirmPassword)
              "
            />
            <div
              class="invalid-feedback"
              *ngIf="f.submitted && f.controls['confirmPassword'].invalid"
            >
              Debe confirmar la contraseña.
            </div>
            <div
              class="invalid-feedback"
              *ngIf="
                f.submitted && usuario.password !== usuario.confirmPassword
              "
            >
              Las contraseñas no coinciden.
            </div>
          </div>
        </div>

        <!-- Mensajes de Estado -->
        <div
          *ngIf="error"
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Error:</strong> {{ error }}
          <button
            type="button"
            class="btn-close"
            (click)="error = undefined"
          ></button>
        </div>

        <div
          *ngIf="mensaje"
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <i class="fas fa-check-circle me-2"></i>
          <strong>Éxito:</strong> {{ mensaje }}
          <button
            type="button"
            class="btn-close"
            (click)="mensaje = undefined"
          ></button>
        </div>

        <!-- Botones de Acción -->
        <div
          class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top"
        >
          <div>
            <small class="text-muted">
              <i class="fas fa-info-circle me-1"></i>
              Los campos marcados con <span class="text-danger">*</span> son
              obligatorios.
            </small>
          </div>
          <div class="d-flex gap-2">
            <a routerLink="/usuarios" class="btn btn-outline-secondary">
              <i class="fas fa-times me-1"></i> Cancelar
            </a>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="guardando"
            >
              <i class="fas fa-save me-1" *ngIf="!guardando"></i>
              <i class="fas fa-spinner fa-spin me-1" *ngIf="guardando"></i>
              {{ guardando ? "Guardando..." : "Guardar Usuario" }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
